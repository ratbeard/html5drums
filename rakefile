require 'rush'


source  = Rush.launch_dir['src/index.haml']
sounds  = Rush.launch_dir['vendor/sounds/*.wav']
out_path =   'out/index.html'

task :default => [:compile, :open]
  
desc "Copy in sounds file paths as <audio> tags"
task :compile do
  require 'haml'
  audio_tags = sounds.map {|s| 
    path = "assets/sounds/#{s.name}"
    name = s.name.split('.')[0]
    "<audio title='#{name}' src='#{path}' autobuffer></audio>"
  }
  engine = Haml::Engine.new(source.contents)
  html = engine.render(Object.new, {:audio_tags => audio_tags})
  File.open(out_path, 'w') {|f| f.puts html }
  require 'sass'
  css = Sass::Engine.new(IO.read('src/style.sass')).render
  File.open('out/style.css', 'w') {|f| f.puts css }
end

task :open do
  `open -a Safari #{out_path}`
end

